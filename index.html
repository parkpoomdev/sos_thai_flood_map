<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SOS Flood Map - ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ô‡πâ‡∏≥‡∏ó‡πà‡∏ß‡∏°</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.css" 
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" 
          crossorigin=""/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <!-- Panel ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (30%) -->
        <div class="filter-panel">
            <div class="filter-panel-content">
                <div class="panel-header">
                <h2>üîç ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h2>
                <button id="refreshBtn" class="refresh-btn">üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä</button>
            </div>
            
            <div class="filter-section">
                <h3>üìç ‡∏ï‡∏≥‡∏ö‡∏• (Subdistrict)</h3>
                <select id="subdistrictFilter" multiple class="multi-select">
                    <option value="all">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                </select>
                <small>‡∏Å‡∏î Ctrl/Cmd ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</small>
            </div>
            
            <div class="filter-section">
                <h3>üë• ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏π‡πâ‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏†‡∏±‡∏¢</h3>
                <div style="margin-bottom: 12px; padding: 10px; background: #f8f9fa; border-radius: 5px;">
                    <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                        <input type="radio" name="victimFilterMode" value="any" checked>
                        <span style="font-size: 0.9rem;"><strong>‡∏£‡∏ß‡∏°:</strong> ‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px;">
                        <input type="radio" name="victimFilterMode" value="all">
                        <span style="font-size: 0.9rem;"><strong>‡πÄ‡∏à‡∏≤‡∏∞‡∏à‡∏á:</strong> ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</span>
                    </label>
                </div>
                <div style="margin-bottom: 10px; display: flex; gap: 8px;">
                    <button id="checkAllVictimsBtn" class="small-btn" style="flex: 1; background: #28a745;">
                        ‚úì ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                    </button>
                    <button id="uncheckAllVictimsBtn" class="small-btn" style="flex: 1; background: #6c757d;">
                        ‚úó ‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                    </button>
                </div>
                <div class="checkbox-group" id="victimTypesList">
                    <!-- ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• -->
                    <div style="text-align: center; color: #6c757d; padding: 10px;">
                        ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏π‡πâ‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏†‡∏±‡∏¢...
                    </div>
                </div>
            </div>
            
            <div class="filter-section">
                <h3>üìä ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠</h3>
                <div class="checkbox-group">
                    <label>
                        <input type="checkbox" name="status" value="0" checked>
                        <span class="status-badge status-0">‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠</span>
                    </label>
                    <label>
                        <input type="checkbox" name="status" value="3" checked>
                        <span class="status-badge status-3">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠</span>
                    </label>
                </div>
            </div>
            
            <div class="filter-section">
                <h3>üìà ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</h3>
                <div class="stats">
                    <div class="stat-item">
                        <span class="stat-label">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</span>
                        <span class="stat-value" id="totalCount">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">‡πÅ‡∏™‡∏î‡∏á:</span>
                        <span class="stat-value" id="filteredCount">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">‡∏£‡∏≠‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠:</span>
                        <span class="stat-value status-0" id="status0Count">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠:</span>
                        <span class="stat-value status-3" id="status3Count">0</span>
                    </div>
                </div>
            </div>
            
            <div class="filter-section">
                <h3>‚öôÔ∏è ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</h3>
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #495057;">
                        üó∫Ô∏è ‡∏°‡∏∏‡∏°‡∏°‡∏≠‡∏á‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà:
                    </label>
                    <select id="mapStyleSelect" class="multi-select" style="min-height: auto; height: auto;">
                        <option value="OpenStreetMap">OpenStreetMap</option>
                        <option value="CartoDB Light Gray">CartoDB Light Gray</option>
                    </select>
                </div>
                <label class="checkbox-label">
                    <input type="checkbox" id="useCache" checked>
                    <span>‡πÉ‡∏ä‡πâ Cache (LocalStorage)</span>
                </label>
                <button id="clearCacheBtn" class="small-btn" style="margin-top: 10px; background: #dc3545;">
                    üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á Cache
                </button>
                <small id="cacheSizeInfo" style="display: block; margin-top: 5px; color: #6c757d;"></small>
            </div>
            
                <div id="loadingIndicator" class="loading-indicator" style="display: none;">
                    <div class="spinner"></div>
                    <p id="loadingText">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
                    <div id="progressBar" class="progress-bar" style="display: none;">
                        <div id="progressFill" class="progress-fill"></div>
                    </div>
                </div>
            </div>
            
            <!-- Footer -->
            <footer class="app-footer">
                <div class="footer-content">
                    <div class="footer-section">
                        <div class="footer-info">
                            <strong>üîÑ Auto Refresh:</strong>
                            <span id="autoRefreshStatus">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</span>
                        </div>
                        <div class="footer-info">
                            <span id="lastUpdateTime">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: -</span>
                        </div>
                    </div>
                    <div class="footer-section">
                        <div class="footer-message">
                            <strong>üìå ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</strong> ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ó‡∏∏‡∏Å 5 ‡∏ô‡∏≤‡∏ó‡∏µ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î 
                            ‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä" ‡πÑ‡∏î‡πâ‡∏ï‡∏•‡∏≠‡∏î‡πÄ‡∏ß‡∏•‡∏≤
                        </div>
                    </div>
                </div>
            </footer>
        </div>
        
        <!-- ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà (45%) -->
        <div class="map-container" id="map">
            <!-- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏õ‡∏¥‡∏î‡∏Ñ‡∏∑‡∏ô Notes Panel ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ñ‡∏π‡∏Å‡∏ã‡πà‡∏≠‡∏ô -->
            <button id="showNotesPanelBtn" class="show-notes-btn" style="display: none;" title="‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏">
                üìù
            </button>
        </div>
        
        <!-- Panel ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ (25%) -->
        <div class="notes-panel" id="notesPanel">
            <div class="notes-panel-header">
                <h2>üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</h2>
                <button id="toggleNotesPanelBtn" class="toggle-btn" title="‡∏ã‡πà‡∏≠‡∏ô/‡πÅ‡∏™‡∏î‡∏á">‚óÄ</button>
            </div>
            <div class="notes-content" id="notesContent">
                <div style="text-align: center; color: #6c757d; padding: 20px;">
                    ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...
                </div>
            </div>
        </div>
    </div>
    
    <!-- Load Leaflet with fallback -->
    <script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin=""
            onerror="loadLeafletFallback()"></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
    <script>
        // Fallback function if primary CDN fails
        function loadLeafletFallback() {
            console.warn('Primary CDN failed, trying fallback...');
            const script = document.createElement('script');
            script.src = 'https://unpkg.com/leaflet@1.9.4/dist/leaflet.js';
            script.crossOrigin = '';
            script.onerror = function() {
                console.error('All CDNs failed to load Leaflet');
                document.getElementById('map').innerHTML = 
                    '<div style="padding: 20px; text-align: center; color: red;">' +
                    '<h3>‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î Leaflet ‡πÑ‡∏î‡πâ</h3>' +
                    '<p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï‡πÅ‡∏•‡∏∞‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö</p>' +
                    '<p>‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ CDN ‡∏≠‡∏∑‡πà‡∏ô</p>' +
                    '</div>';
            };
            document.head.appendChild(script);
        }
    </script>
    <script src="app.js"></script>
</body>
</html>

